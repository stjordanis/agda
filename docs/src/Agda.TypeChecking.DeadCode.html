<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Agda.TypeChecking.DeadCode</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.DeadCode.html#eliminateDeadCode"><span class="hs-identifier">eliminateDeadCode</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">All</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HMap</span></span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html"><span class="hs-identifier">Agda.Syntax.Abstract</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.html"><span class="hs-identifier">Agda.Syntax.Internal</span></a></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Internal.Names.html"><span class="hs-identifier">Agda.Syntax.Internal.Names</span></a></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Syntax.Scope.Base.html"><span class="hs-identifier">Agda.Syntax.Scope.Base</span></a></span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.Benchmarking.html"><span class="hs-identifier">Agda.Benchmarking</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Bench</span></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Benchmark.html"><span class="hs-identifier">Agda.TypeChecking.Monad.Benchmark</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Bench</span></span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.html"><span class="hs-identifier">Agda.TypeChecking.Monad</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Reduce.html"><span class="hs-identifier">Agda.TypeChecking.Reduce</span></a></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Agda.Utils.Lens.html"><span class="hs-identifier">Agda.Utils.Lens</span></a></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-comment">-- | Run before serialisation to remove any definitions that are not reachable</span><span>
</span><span id="line-24"></span><span class="hs-comment">--   from the public interface to the module.</span><span>
</span><span id="line-25"></span><span class="annot"><a href="Agda.TypeChecking.DeadCode.html#eliminateDeadCode"><span class="hs-identifier hs-type">eliminateDeadCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DisplayForms"><span class="hs-identifier hs-type">DisplayForms</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#TCM"><span class="hs-identifier hs-type">TCM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#DisplayForms"><span class="hs-identifier hs-type">DisplayForms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Signature"><span class="hs-identifier hs-type">Signature</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span id="eliminateDeadCode"><span class="annot"><span class="annottext">eliminateDeadCode :: DisplayForms -&gt; Signature -&gt; TCM (DisplayForms, Signature)
</span><a href="Agda.TypeChecking.DeadCode.html#eliminateDeadCode"><span class="hs-identifier hs-var hs-var">eliminateDeadCode</span></a></span></span><span> </span><span id="local-6989586621681095212"><span class="annot"><span class="annottext">DisplayForms
</span><a href="#local-6989586621681095212"><span class="hs-identifier hs-var">disp</span></a></span></span><span> </span><span id="local-6989586621681095211"><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681095211"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Account (BenchPhase (TCMT IO))
-&gt; TCM (DisplayForms, Signature) -&gt; TCM (DisplayForms, Signature)
forall (m :: * -&gt; *) c.
MonadBench m =&gt;
Account (BenchPhase m) -&gt; m c -&gt; m c
</span><a href="Agda.Utils.Benchmark.html#billTo"><span class="hs-identifier hs-var">Bench.billTo</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BenchPhase (TCMT IO)
Phase
</span><a href="Agda.Benchmarking.html#DeadCode"><span class="hs-identifier hs-var">Bench.DeadCode</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TCM (DisplayForms, Signature) -&gt; TCM (DisplayForms, Signature))
-&gt; TCM (DisplayForms, Signature) -&gt; TCM (DisplayForms, Signature)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-27"></span><span>  </span><span id="local-6989586621681095208"><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621681095208"><span class="hs-identifier hs-var">patsyn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCMT IO PatternSynDefns
forall (m :: * -&gt; *). ReadTCState m =&gt; m PatternSynDefns
</span><a href="Agda.TypeChecking.Monad.State.html#getPatternSyns"><span class="hs-identifier hs-var">getPatternSyns</span></a></span><span>
</span><span id="line-28"></span><span>  </span><span id="local-6989586621681095206"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681095206"><span class="hs-identifier hs-var">public</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(AbstractName -&gt; QName) -&gt; Set AbstractName -&gt; Set QName
forall a b. (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.mapMonotonic</span></span><span> </span><span class="annot"><span class="annottext">AbstractName -&gt; QName
</span><a href="Agda.Syntax.Scope.Base.html#anameName"><span class="hs-identifier hs-var">anameName</span></a></span><span> </span><span class="annot"><span class="annottext">(Set AbstractName -&gt; Set QName)
-&gt; (ScopeInfo -&gt; Set AbstractName) -&gt; ScopeInfo -&gt; Set QName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ScopeInfo -&gt; Set AbstractName
</span><a href="Agda.Syntax.Scope.Base.html#publicNames"><span class="hs-identifier hs-var">publicNames</span></a></span><span> </span><span class="annot"><span class="annottext">(ScopeInfo -&gt; Set QName)
-&gt; TCMT IO ScopeInfo -&gt; TCMT IO (Set QName)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TCMT IO ScopeInfo
forall (m :: * -&gt; *). ReadTCState m =&gt; m ScopeInfo
</span><a href="Agda.TypeChecking.Monad.State.html#getScope"><span class="hs-identifier hs-var">getScope</span></a></span><span>
</span><span id="line-29"></span><span>  </span><span id="local-6989586621681095199"><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681095199"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; TCMT IO Definition)
-&gt; HashMap QName Definition -&gt; TCMT IO (HashMap QName Definition)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; TCMT IO Definition
forall a (m :: * -&gt; *).
(InstantiateFull a, MonadReduce m) =&gt;
a -&gt; m a
</span><a href="Agda.TypeChecking.Reduce.html#instantiateFull"><span class="hs-identifier hs-var">instantiateFull</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap QName Definition -&gt; TCMT IO (HashMap QName Definition))
-&gt; HashMap QName Definition -&gt; TCMT IO (HashMap QName Definition)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681095211"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="annot"><span class="annottext">Signature
-&gt; Lens' (HashMap QName Definition) Signature
-&gt; HashMap QName Definition
forall o i. o -&gt; Lens' i o -&gt; i
</span><a href="Agda.Utils.Lens.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' (HashMap QName Definition) Signature
</span><a href="Agda.TypeChecking.Monad.Base.html#sigDefinitions"><span class="hs-identifier hs-var">sigDefinitions</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span class="hs-comment">-- #2921: Eliminating definitions with attached COMPILE pragmas results in</span><span>
</span><span id="line-31"></span><span>  </span><span class="hs-comment">-- the pragmas not being checked. Simple solution: don't eliminate these.</span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681095192"><span class="annot"><span class="annottext">hasCompilePragma :: Set QName
</span><a href="#local-6989586621681095192"><span class="hs-identifier hs-var hs-var">hasCompilePragma</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[QName] -&gt; Set QName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([QName] -&gt; Set QName)
-&gt; (HashMap QName Definition -&gt; [QName])
-&gt; HashMap QName Definition
-&gt; Set QName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition -&gt; [QName]
forall k v. HashMap k v -&gt; [k]
</span><span class="hs-identifier hs-var">HMap.keys</span></span><span> </span><span class="annot"><span class="annottext">(HashMap QName Definition -&gt; [QName])
-&gt; (HashMap QName Definition -&gt; HashMap QName Definition)
-&gt; HashMap QName Definition
-&gt; [QName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; Bool)
-&gt; HashMap QName Definition -&gt; HashMap QName Definition
forall v k. (v -&gt; Bool) -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HMap.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Definition -&gt; Bool) -&gt; Definition -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map [Char] [CompilerPragma] -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.null</span></span><span> </span><span class="annot"><span class="annottext">(Map [Char] [CompilerPragma] -&gt; Bool)
-&gt; (Definition -&gt; Map [Char] [CompilerPragma])
-&gt; Definition
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Map [Char] [CompilerPragma]
</span><a href="Agda.TypeChecking.Monad.Base.html#defCompiledRep"><span class="hs-identifier hs-var">defCompiledRep</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HashMap QName Definition -&gt; Set QName)
-&gt; HashMap QName Definition -&gt; Set QName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681095199"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681095185"><span class="annot"><span class="annottext">r :: Set QName
</span><a href="#local-6989586621681095185"><span class="hs-identifier hs-var hs-var">r</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set QName
-&gt; PatternSynDefns -&gt; HashMap QName Definition -&gt; Set QName
</span><a href="Agda.TypeChecking.DeadCode.html#reachableFrom"><span class="hs-identifier hs-var">reachableFrom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set QName -&gt; Set QName -&gt; Set QName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.union</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681095206"><span class="hs-identifier hs-var">public</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681095192"><span class="hs-identifier hs-var">hasCompilePragma</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621681095208"><span class="hs-identifier hs-var">patsyn</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681095199"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-34"></span><span>      </span><span id="local-6989586621681095182"><span class="annot"><span class="annottext">dead :: Set QName
</span><a href="#local-6989586621681095182"><span class="hs-identifier hs-var hs-var">dead</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[QName] -&gt; Set QName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap QName Definition -&gt; [QName]
forall k v. HashMap k v -&gt; [k]
</span><span class="hs-identifier hs-var">HMap.keys</span></span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681095199"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; Set QName -&gt; Set QName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`Set.difference`</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681095185"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-35"></span><span>      </span><span id="local-6989586621681095180"><span class="annot"><span class="annottext">valid :: LocalDisplayForm -&gt; Bool
</span><a href="#local-6989586621681095180"><span class="hs-identifier hs-var hs-var">valid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">All -&gt; Bool
</span><span class="hs-identifier hs-var">getAll</span></span><span> </span><span class="annot"><span class="annottext">(All -&gt; Bool)
-&gt; (LocalDisplayForm -&gt; All) -&gt; LocalDisplayForm -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; All) -&gt; LocalDisplayForm -&gt; All
forall a m. (NamesIn a, Monoid m) =&gt; (QName -&gt; m) -&gt; a -&gt; m
</span><a href="Agda.Syntax.Internal.Names.html#namesIn%27"><span class="hs-identifier hs-var">namesIn'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; All
</span><span class="hs-identifier hs-var">All</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; All) -&gt; (QName -&gt; Bool) -&gt; QName -&gt; All
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QName -&gt; Set QName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.notMember`</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681095182"><span class="hs-identifier hs-var">dead</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- no used name is dead</span><span>
</span><span id="line-36"></span><span>      </span><span id="local-6989586621681095175"><span class="annot"><span class="annottext">defs' :: HashMap QName Definition
</span><a href="#local-6989586621681095175"><span class="hs-identifier hs-var hs-var">defs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Definition -&gt; Definition)
-&gt; HashMap QName Definition -&gt; HashMap QName Definition
forall v1 v2 k. (v1 -&gt; v2) -&gt; HashMap k v1 -&gt; HashMap k v2
</span><span class="hs-identifier hs-var">HMap.map</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681095173"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681095173"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681095173"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">defDisplay :: [LocalDisplayForm]
</span><a href="Agda.TypeChecking.Monad.Base.html#defDisplay"><span class="hs-identifier hs-var">defDisplay</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LocalDisplayForm -&gt; Bool)
-&gt; [LocalDisplayForm] -&gt; [LocalDisplayForm]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">LocalDisplayForm -&gt; Bool
</span><a href="#local-6989586621681095180"><span class="hs-identifier hs-var">valid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Definition -&gt; [LocalDisplayForm]
</span><a href="Agda.TypeChecking.Monad.Base.html#defDisplay"><span class="hs-identifier hs-var">defDisplay</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681095173"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span>            </span><span class="annot"><span class="annottext">(HashMap QName Definition -&gt; HashMap QName Definition)
-&gt; HashMap QName Definition -&gt; HashMap QName Definition
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(QName -&gt; Definition -&gt; Bool)
-&gt; HashMap QName Definition -&gt; HashMap QName Definition
forall k v. (k -&gt; v -&gt; Bool) -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HMap.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681095170"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681095170"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">Definition
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QName -&gt; Set QName -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681095170"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681095185"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681095199"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-38"></span><span>      </span><span id="local-6989586621681095168"><span class="annot"><span class="annottext">disp' :: DisplayForms
</span><a href="#local-6989586621681095168"><span class="hs-identifier hs-var hs-var">disp'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([LocalDisplayForm] -&gt; Bool) -&gt; DisplayForms -&gt; DisplayForms
forall v k. (v -&gt; Bool) -&gt; HashMap k v -&gt; HashMap k v
</span><span class="hs-identifier hs-var">HMap.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([LocalDisplayForm] -&gt; Bool) -&gt; [LocalDisplayForm] -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[LocalDisplayForm] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DisplayForms -&gt; DisplayForms) -&gt; DisplayForms -&gt; DisplayForms
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([LocalDisplayForm] -&gt; [LocalDisplayForm])
-&gt; DisplayForms -&gt; DisplayForms
forall v1 v2 k. (v1 -&gt; v2) -&gt; HashMap k v1 -&gt; HashMap k v2
</span><span class="hs-identifier hs-var">HMap.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LocalDisplayForm -&gt; Bool)
-&gt; [LocalDisplayForm] -&gt; [LocalDisplayForm]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">LocalDisplayForm -&gt; Bool
</span><a href="#local-6989586621681095180"><span class="hs-identifier hs-var">valid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DisplayForms
</span><a href="#local-6989586621681095212"><span class="hs-identifier hs-var">disp</span></a></span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Int -&gt; [Char] -&gt; TCMT IO ()
forall (m :: * -&gt; *).
MonadDebug m =&gt;
[Char] -&gt; Int -&gt; [Char] -&gt; m ()
</span><a href="Agda.TypeChecking.Monad.Debug.html#reportSLn"><span class="hs-identifier hs-var">reportSLn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;tc.dead&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; TCMT IO ()) -&gt; [Char] -&gt; TCMT IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Removed &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashMap QName Definition -&gt; Int
forall k v. HashMap k v -&gt; Int
</span><span class="hs-identifier hs-var">HMap.size</span></span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681095199"><span class="hs-identifier hs-var">defs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition -&gt; Int
forall k v. HashMap k v -&gt; Int
</span><span class="hs-identifier hs-var">HMap.size</span></span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681095175"><span class="hs-identifier hs-var">defs'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; unused definitions.&quot;</span></span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><span class="annottext">(DisplayForms, Signature) -&gt; TCM (DisplayForms, Signature)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DisplayForms
</span><a href="#local-6989586621681095168"><span class="hs-identifier hs-var">disp'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Lens' (HashMap QName Definition) Signature
-&gt; LensSet (HashMap QName Definition) Signature
forall i o. Lens' i o -&gt; LensSet i o
</span><a href="Agda.Utils.Lens.html#set"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' (HashMap QName Definition) Signature
</span><a href="Agda.TypeChecking.Monad.Base.html#sigDefinitions"><span class="hs-identifier hs-var">sigDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681095175"><span class="hs-identifier hs-var">defs'</span></a></span><span> </span><span class="annot"><span class="annottext">Signature
</span><a href="#local-6989586621681095211"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="annot"><a href="Agda.TypeChecking.DeadCode.html#reachableFrom"><span class="hs-identifier hs-type">reachableFrom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.html#PatternSynDefns"><span class="hs-identifier hs-type">A.PatternSynDefns</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Agda.TypeChecking.Monad.Base.html#Definitions"><span class="hs-identifier hs-type">Definitions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Agda.Syntax.Abstract.Name.html#QName"><span class="hs-identifier hs-type">QName</span></a></span><span>
</span><span id="line-43"></span><span id="reachableFrom"><span class="annot"><span class="annottext">reachableFrom :: Set QName
-&gt; PatternSynDefns -&gt; HashMap QName Definition -&gt; Set QName
</span><a href="Agda.TypeChecking.DeadCode.html#reachableFrom"><span class="hs-identifier hs-var hs-var">reachableFrom</span></a></span></span><span> </span><span id="local-6989586621681095159"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681095159"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span id="local-6989586621681095158"><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621681095158"><span class="hs-identifier hs-var">psyns</span></a></span></span><span> </span><span id="local-6989586621681095157"><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681095157"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; [QName] -&gt; Set QName
</span><a href="#local-6989586621681095156"><span class="hs-identifier hs-var">follow</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681095159"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set QName -&gt; [QName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681095159"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-45"></span><span>    </span><span id="local-6989586621681095156"><span class="annot"><span class="annottext">follow :: Set QName -&gt; [QName] -&gt; Set QName
</span><a href="#local-6989586621681095156"><span class="hs-identifier hs-var hs-var">follow</span></a></span></span><span> </span><span id="local-6989586621681095154"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681095154"><span class="hs-identifier hs-var">visited</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681095154"><span class="hs-identifier hs-var">visited</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><a href="#local-6989586621681095156"><span class="hs-identifier hs-var">follow</span></a></span><span> </span><span id="local-6989586621681095153"><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681095153"><span class="hs-identifier hs-var">visited</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681095152"><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681095152"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681095151"><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621681095151"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; [QName] -&gt; Set QName
</span><a href="#local-6989586621681095156"><span class="hs-identifier hs-var">follow</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set QName -&gt; Set QName -&gt; Set QName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.union</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681095153"><span class="hs-identifier hs-var">visited</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681095150"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set QName -&gt; [QName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681095150"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">[QName] -&gt; [QName] -&gt; [QName]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[QName]
</span><a href="#local-6989586621681095151"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-48"></span><span>        </span><span id="local-6989586621681095150"><span class="annot"><span class="annottext">new :: Set QName
</span><a href="#local-6989586621681095150"><span class="hs-identifier hs-var hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681095149"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="annot"><span class="annottext">Set QName -&gt; Set QName -&gt; Set QName
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`Set.difference`</span></span><span> </span><span class="annot"><span class="annottext">Set QName
</span><a href="#local-6989586621681095153"><span class="hs-identifier hs-var">visited</span></a></span><span>
</span><span id="line-49"></span><span>        </span><span id="local-6989586621681095149"><span class="annot"><span class="annottext">names :: Set QName
</span><a href="#local-6989586621681095149"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">QName -&gt; HashMap QName Definition -&gt; Maybe Definition
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">HMap.lookup</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681095152"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap QName Definition
</span><a href="#local-6989586621681095157"><span class="hs-identifier hs-var">defs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-50"></span><span>                  </span><span class="annot"><span class="annottext">Maybe Definition
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe PSyn -&gt; Set QName
forall a m. (NamesIn a, Collection QName m) =&gt; a -&gt; m
</span><a href="Agda.Syntax.Internal.Names.html#namesIn"><span class="hs-identifier hs-var">namesIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatternSynDefn -&gt; PSyn
</span><a href="Agda.Syntax.Internal.Names.html#PSyn"><span class="hs-identifier hs-var">PSyn</span></a></span><span> </span><span class="annot"><span class="annottext">(PatternSynDefn -&gt; PSyn) -&gt; Maybe PatternSynDefn -&gt; Maybe PSyn
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">QName -&gt; PatternSynDefns -&gt; Maybe PatternSynDefn
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">QName
</span><a href="#local-6989586621681095152"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">PatternSynDefns
</span><a href="#local-6989586621681095158"><span class="hs-identifier hs-var">psyns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621681095144"><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681095144"><span class="hs-identifier hs-var">d</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Definition -&gt; Set QName
forall a m. (NamesIn a, Collection QName m) =&gt; a -&gt; m
</span><a href="Agda.Syntax.Internal.Names.html#namesIn"><span class="hs-identifier hs-var">namesIn</span></a></span><span> </span><span class="annot"><span class="annottext">Definition
</span><a href="#local-6989586621681095144"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-52"></span></pre></body></html>